#//%2006////////////////////////////////////////////////////////////////////////
#//
#// Copyright (c) 2000, 2001, 2002 BMC Software; Hewlett-Packard Development
#// Company, L.P.; IBM Corp.; The Open Group; Tivoli Systems.
#// Copyright (c) 2003 BMC Software; Hewlett-Packard Development Company, L.P.;
#// IBM Corp.; EMC Corporation, The Open Group.
#// Copyright (c) 2004 BMC Software; Hewlett-Packard Development Company, L.P.;
#// IBM Corp.; EMC Corporation; VERITAS Software Corporation; The Open Group.
#// Copyright (c) 2005 Hewlett-Packard Development Company, L.P.; IBM Corp.;
#// EMC Corporation; VERITAS Software Corporation; The Open Group.
#// Copyright (c) 2006 Hewlett-Packard Development Company, L.P.; IBM Corp.;
#// EMC Corporation; Symantec Corporation; The Open Group.
#//
#// Permission is hereby granted, free of charge, to any person obtaining a copy
#// of this software and associated documentation files (the "Software"), to
#// deal in the Software without restriction, including without limitation the
#// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
#// sell copies of the Software, and to permit persons to whom the Software is
#// furnished to do so, subject to the following conditions:
#// 
#// THE ABOVE COPYRIGHT NOTICE AND THIS PERMISSION NOTICE SHALL BE INCLUDED IN
#// ALL COPIES OR SUBSTANTIAL PORTIONS OF THE SOFTWARE. THE SOFTWARE IS PROVIDED
#// "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
#// LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
#// PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
#// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
#// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
#// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#//
#//==============================================================================
include $(PEGASUS_ROOT)/mak/config.mak
include $(PEGASUS_ROOT)/mak/commands.mak

ifndef PEGASUS_STAGING_DIR
   PEGASUS_STAGING_DIR = $(PEGASUS_HOME)/stageSDK
endif

ifndef PEGASUS_SAMPLES_DIR
   PEGASUS_SAMPLES_DIR = samples
endif

ifndef PEGASUS_INCLUDE_DIR
   PEGASUS_INCLUDE_DIR = include
endif

ifndef PEGASUS_HTML_DIR
   PEGASUS_HTML_DIR = html
endif

ifndef PEGASUS_DOC_DIR
   PEGASUS_DOC_DIR = doc
endif


INCLUDE_SRCPATH = $(PEGASUS_ROOT)/src

HTML_SRCPATH = $(PEGASUS_HOME)/html

DOC_SRCPATH1 = $(PEGASUS_ROOT)/doc

CLIENT_SRCPATH1 = $(PEGASUS_ROOT)/src/SDK/samples

PROVIDER_SRCPATH1 = $(PEGASUS_ROOT)/src/SDK/samples/Providers

INCLUDE_DIRS = \
  Pegasus \
  Pegasus/Client \
  Pegasus/Common \
  Pegasus/Consumer \
  Pegasus/Provider \
  Pegasus/Provider/CMPI 

INCLUDE_FILES = \
   Pegasus/Client/CIMClientException.h \
   Pegasus/Client/CIMClient.h \
   Pegasus/Client/ClientOpPerformanceDataHandler.h \
   Pegasus/Client/Linkage.h \
   Pegasus/Common/AcceptLanguageList.h \
   Pegasus/Common/Array.h \
   Pegasus/Common/ArrayInter.h \
   Pegasus/Common/Char16.h \
   Pegasus/Common/CIMClass.h \
   Pegasus/Common/CIMDateTime.h \
   Pegasus/Common/CIMFlavor.h \
   Pegasus/Common/CIMIndication.h \
   Pegasus/Common/CIMInstance.h \
   Pegasus/Common/CIMMethod.h \
   Pegasus/Common/CIMName.h \
   Pegasus/Common/CIMObject.h \
   Pegasus/Common/CIMObjectPath.h \
   Pegasus/Common/CIMOperationType.h \
   Pegasus/Common/CIMParameter.h \
   Pegasus/Common/CIMParamValue.h \
   Pegasus/Common/CIMProperty.h \
   Pegasus/Common/CIMPropertyList.h \
   Pegasus/Common/CIMQualifierDecl.h \
   Pegasus/Common/CIMQualifier.h \
   Pegasus/Common/CIMScope.h \
   Pegasus/Common/CIMStatusCode.h \
   Pegasus/Common/CIMType.h \
   Pegasus/Common/CIMValue.h \
   Pegasus/Common/Config.h \
   Pegasus/Common/ContentLanguageList.h \
   Pegasus/Common/Exception.h \
   Pegasus/Common/LanguageTag.h \
   Pegasus/Common/Linkage.h \
   Pegasus/Common/OperationContext.h \
   Pegasus/Common/ResponseHandler.h \
   Pegasus/Common/SSLContext.h \
   Pegasus/Common/String.h \
   Pegasus/Consumer/CIMIndicationConsumer.h \
   Pegasus/Consumer/Linkage.h \
   Pegasus/Provider/CIMAssociationProvider.h \
   Pegasus/Provider/CIMIndicationConsumerProvider.h \
   Pegasus/Provider/CIMIndicationProvider.h \
   Pegasus/Provider/CIMInstanceProvider.h \
   Pegasus/Provider/CIMMethodProvider.h \
   Pegasus/Provider/CIMOMHandle.h \
   Pegasus/Provider/CIMProvider.h \
   Pegasus/Provider/Linkage.h \
   Pegasus/Provider/ProviderException.h

## Common Platform Include for SOLARIS platform. 
## Add Platorm_SOLARIS_XXX_CC.h file
ifdef PEGASUS_OS_SOLARIS
   ifeq ($(findstring _CC, $(PEGASUS_PLATFORM)), _CC)
      INCLUDE_FILES += Pegasus/Common/Platform_SOLARIS_XXX_CC.h
   endif
endif

# CMPI header files
INCLUDE_FILES += \
   Pegasus/Provider/CMPI/cmpift.h \
   Pegasus/Provider/CMPI/cmpidt.h \
   Pegasus/Provider/CMPI/cmpimacs.h \
   Pegasus/Provider/CMPI/cmpios.h \
   Pegasus/Provider/CMPI/cmpipl.h

SAMPLES_DIRS = \
   Clients \
   Clients/DefaultC++ \
   Clients/DefaultC++/EnumInstances \
   Clients/DefaultC++/InvokeMethod \
   Clients/DefaultC++/SendTestIndications \
   Clients/DefaultC++/Associations \
   Providers \
   Providers/DefaultC++ \
   Providers/DefaultC++/IndicationProvider \
   Providers/DefaultC++/InstanceProvider \
   Providers/DefaultC++/MethodProvider \
   Providers/DefaultC++/SimpleDisplayConsumer \
   Providers/DefaultC++/AssociationProvider \
   Providers/CMPI \
   Providers/CMPI/FilesAndDirectories \
   Providers/CMPI/CWS_Util \
   Providers/Load \
   Providers/Load/$(PEGASUS_CIM_SCHEMA) \
   Providers/Load/$(PEGASUS_CIM_SCHEMA)/DMTF \
   Providers/Load/$(PEGASUS_CIM_SCHEMA)/DMTF/Core \
   Providers/Load/$(PEGASUS_CIM_SCHEMA)/DMTF/Event \
   Providers/Load/$(PEGASUS_CIM_SCHEMA)/DMTF/System \
   mak

DOCSRCPATH1FILES = \
   SecurityGuidelinesForDevelopers.html

CLIENTSRCPATH1FILES = \
   Makefile \
   mak/program.mak \
   mak/build.mak \
   mak/recurse.mak \
   mak/library.mak \
   mak/common.mak \
   Clients/Makefile \
   Clients/DefaultC++/Makefile \
   Clients/DefaultC++/EnumInstances/Makefile \
   Clients/DefaultC++/InvokeMethod/Makefile \
   Clients/DefaultC++/SendTestIndications/Makefile  \
   Clients/DefaultC++/Associations/Makefile \
   Clients/DefaultC++/EnumInstances/EnumInstances.cpp \
   Clients/DefaultC++/InvokeMethod/InvokeMethod.cpp \
   Clients/DefaultC++/SendTestIndications/SendTestIndications.cpp \
   Clients/DefaultC++/Associations/AssociationTestClient.cpp

CIMMOFFILES = \
   DMTF/qualifiers.mof \
   DMTF/qualifiers_optional.mof \
   DMTF/Core/CIM_ManagedElement.mof \
   DMTF/Core/CIM_ManagedSystemElement.mof \
   DMTF/Core/CIM_LogicalElement.mof \
   DMTF/Core/CIM_Component.mof \
   DMTF/Event/CIM_Indication.mof \
   DMTF/System/CIM_LogicalFile.mof \
   DMTF/System/CIM_DataFile.mof \
   DMTF/System/CIM_DirectoryContainsFile.mof \
   DMTF/System/CIM_Directory.mof

PROVIDERSRCPATH1FILES = \
   Makefile \
   Load/Makefile \
   Load/SDK_CIM_Schema.mof \
   Load/SampleProviderSchema.mof \
   Load/IndicationProviderR.mof \
   Load/InstanceProviderR.mof \
   Load/MethodProviderR.mof \
   Load/SimpleDisplayConsumerR.mof \
   Load/CWS_FilesAndDir.mof \
   Load/CWS_FilesAndDirR.mof \
   Load/AssociationProvider.mof \
   Load/AssociationProviderR.mof \
   DefaultC++/Makefile \
   DefaultC++/InstanceProvider/Makefile \
   DefaultC++/InstanceProvider/InstanceProvider.cpp \
   DefaultC++/InstanceProvider/InstanceProviderMain.cpp \
   DefaultC++/InstanceProvider/InstanceProvider.h \
   DefaultC++/InstanceProvider/EnumerateInstancesrspgood.xml \
   DefaultC++/InstanceProvider/EnumerateInstances.xml \
   DefaultC++/MethodProvider/Makefile \
   DefaultC++/MethodProvider/MethodProvider.cpp \
   DefaultC++/MethodProvider/MethodProviderMain.cpp \
   DefaultC++/MethodProvider/MethodProvider.h \
   DefaultC++/MethodProvider/InvokeMethod.xml \
   DefaultC++/MethodProvider/InvokeMethodrspgood.xml \
   DefaultC++/IndicationProvider/Makefile \
   DefaultC++/IndicationProvider/IndicationProvider.cpp \
   DefaultC++/IndicationProvider/IndicationProvider.h \
   DefaultC++/IndicationProvider/IndicationProviderMain.cpp \
   DefaultC++/SimpleDisplayConsumer/Makefile \
   DefaultC++/SimpleDisplayConsumer/SimpleDisplayConsumerMain.cpp \
   DefaultC++/SimpleDisplayConsumer/SimpleDisplayConsumer.cpp \
   DefaultC++/SimpleDisplayConsumer/SimpleDisplayConsumer.h \
   DefaultC++/AssociationProvider/Makefile \
   DefaultC++/AssociationProvider/AssociationProvider.cpp \
   DefaultC++/AssociationProvider/AssociationProvider.h \
   DefaultC++/AssociationProvider/AssociationProviderMain.cpp 

# CMPI header files
PROVIDERSRCPATH1FILES += \
   CMPI/Makefile \
   CMPI/FilesAndDirectories/Makefile \
   CMPI/FilesAndDirectories/CWS_Directory.c \
   CMPI/FilesAndDirectories/CWS_DirectoryContainsFile.c \
   CMPI/FilesAndDirectories/CWS_FileUtils.c \
   CMPI/FilesAndDirectories/CWS_PlainFile.c \
   CMPI/FilesAndDirectories/CWS_FileUtils.h \
   CMPI/CWS_Util/Makefile \
   CMPI/CWS_Util/cwssimdata.c \
   CMPI/CWS_Util/cwsutil.h \
   CMPI/CWS_Util/cwsutil.c 

define NL


endef

error:
	@echo "Please specify an action"

stageSDK:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageINCLUDE
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageHTML
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageSAMPLES
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile stageDOCS

stageINCLUDE:
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_INCLUDE_DIR)
	@$(foreach i, $(INCLUDE_DIRS), $(MKDIRHIER) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_INCLUDE_DIR)/$(i)$(NL))
	@$(foreach i, $(INCLUDE_FILES), $(COPY) $(INCLUDE_SRCPATH)/$(i) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_INCLUDE_DIR)/$(i)$(NL))
	@$(COPY) $(INCLUDE_SRCPATH)/Pegasus/Common/Platform_$(PEGASUS_PLATFORM).h \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_INCLUDE_DIR)/Pegasus/Common/Platform_$(PEGASUS_PLATFORM).h

create_ProductInstallationVerificationScript: 
	@$(RM) $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "$(ECHO-E) \"\nPEGASUS SYSETM DIRECTORIES\"" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "ls -ld $(PEGASUS_INCLUDE_DIR)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "$(ECHO-E) \"\nPEGASUS DEVEL DIRECTORIES\"" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "ls -ld $(PEGASUS_SAMPLES_DIR)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(foreach i, $(SAMPLE_DIRS), $(ECHO-E) "ls -ld" \
             "$(PEGASUS_SAMLES_DIR)/$(i)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall$(NL))
	@$(ECHO-E) "ls -ld $(PEGASUS_INCLUDE_DIR)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(foreach i, $(INCLUDE_DIRS), $(ECHO-E) "ls -ld" \
             "$(PEGASUS_INCLUDE_DIR)/$(i)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall$(NL))
	@$(ECHO-E) "ls -ld $(PEGASUS_HTML_DIR)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "$(ECHO-E) \"\nPEGASUS INCLUDE FILES\"" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(foreach i, $(INCLUDE_FILES), $(ECHO-E) "ls -ld" \
             "$(PEGASUS_INCLUDE_DIR)/$(i)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall$(NL))
	@$(ECHO-E) "$(ECHO-E) \"\nPEGASUS SAMPLE FILES\"" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(foreach i, $(CLIENTSRCPATH1FILES), $(ECHO-E) "ls -ld" \
             "$(PEGASUS_SAMPLES_DIR)/$(i)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall$(NL))
	@$(foreach i, $(PROVIDERSCPATH1FILES), $(ECHO-E) "ls -ld" \
             "$(PEGASUS_SAMPLES_DIR)/Providers/$(i)" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall$(NL))
	@$(ECHO-E) "ls -l $(PEGASUS_SAMPLES_DIR)/mak/config.mak" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall
	@$(ECHO-E) "ls -l" \
             "$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak" \
             >> $(PEGASUS_HOME)/PegasusVerifyDevelInstall

createSDKEnvVarFile:
	@$(ECHO) "ifndef PEGASUS_BIN_DIR" \
            > $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_BIN_DIR = $(PEGASUS_BIN_DIR)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_DEST_LIB_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_DEST_LIB_DIR = $(PEGASUS_DEST_LIB_DIR)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_PROVIDER_LIB_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_PROVIDER_LIB_DIR = $(PEGASUS_PROVIDER_LIB_DIR)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_SAMPLES_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_SAMPLES_DIR = $(PEGASUS_SAMPLES_DIR)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_SAMPLE_OBJ_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_SAMPLE_OBJ_DIR = $(PEGASUS_SAMPLES_DIR)/obj" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_SAMPLE_LIB_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_SAMPLE_LIB_DIR = $(PEGASUS_SAMPLES_DIR)/lib" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_SAMPLE_BIN_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_SAMPLE_BIN_DIR = $(PEGASUS_SAMPLES_DIR)/bin" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_INDICATION_CONSUMER_LOG_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_INDICATION_CONSUMER_LOG_DIR =" \
            "$(PEGASUS_SAMPLES_DIR)/tmp" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_INCLUDE_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_INCLUDE_DIR = $(PEGASUS_INCLUDE_DIR)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "ifndef PEGASUS_CIM_SCHEMA_DIR" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   PEGASUS_CIM_SCHEMA_DIR =" \
            "$(PEGASUS_SAMPLES_DIR)/Providers/Load/$(PEGASUS_CIM_SCHEMA)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "   CIM_SCHEMA_VER = " \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak
	@$(ECHO) "" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/SDKEnvVar.mak

createConfigFile:
	@$(ECHO) "ifndef PEGASUS_PLATFORM" \
            > $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "   PEGASUS_PLATFORM = $(PEGASUS_PLATFORM)" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "endif" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(ECHO) "" \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/config.mak
	@$(CAT)  $(PEGASUS_ROOT)/src/SDK/samples/mak/config.mak \
            >> $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/config.mak

stageDOCS:
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_DOC_DIR)
	@$(foreach i, $(DOCSRCPATH1FILES), $(COPY) $(DOC_SRCPATH1)/$(i) $(PEGASUS_STAGING_DIR)/$(PEGASUS_DOC_DIR)/$(i)$(NL))

stageSAMPLES:
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_OBJ_DIR)
	@$(TOUCH) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_OBJ_DIR)/target
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_LIB_DIR)
	@$(TOUCH) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_LIB_DIR)/target
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_BIN_DIR)
	@$(TOUCH) $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_BIN_DIR)/target
	@$(foreach i, $(SAMPLES_DIRS), $(MKDIRHIER) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/$(i)$(NL))
	@$(foreach i, $(CLIENTSRCPATH1FILES), $(COPY) $(CLIENT_SRCPATH1)/$(i) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/$(i)$(NL))
	@$(foreach i, $(CIMMOFFILES), $(COPY) $(CIM_SCHEMA_DIR)/$(i) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/Load/$(PEGASUS_CIM_SCHEMA)/$(i)$(NL))
	@$(foreach i, $(PROVIDERSRCPATH1FILES), $(COPY) $(PROVIDER_SRCPATH1)/$(i) \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/$(i)$(NL))
	@$(COPY) $(CLIENT_SRCPATH1)/mak/$(PEGASUS_PLATFORM).mak \
            $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/mak/$(PEGASUS_PLATFORM).mak 
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile createConfigFile
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile createSDKEnvVarFile

stageHTML:
	@$(RMDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_HTML_DIR)
	@$(MKDIRHIER) $(PEGASUS_STAGING_DIR)/$(PEGASUS_HTML_DIR)
	@$(MAKE) --directory=$(PEGASUS_ROOT)/doc/SDK -f Makefile \
            PEGASUS_HTML_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_HTML_DIR) \
            buildDoc_ContinueOnError

_append_preunSectionToSpecFile:
	@$(ECHO-E) "%preun devel" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "# Check if the SDK has been setup" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "if [ -f $(PEGASUS_SAMPLES_DIR)/SDKIsSetup ]; then" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "   make --directory $(PEGASUS_SAMPLES_DIR) -s unsetupSDK" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "   if [ \044? != 0 ]; then" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"++++++++++++++++++++++++++++++++++++++++++++++\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"ERROR: Failed to deregister sample providers.\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"To remove the SDK rpm without deregistering\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"the sample providers, first remove file\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"$(PEGASUS_SAMPLES_DIR)/SDKIsSetup,\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"then remove SDK rpm.\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      echo \"++++++++++++++++++++++++++++++++++++++++++++++\" >&2" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "      exit 1" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "   fi" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "fi" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "make --directory $(PEGASUS_SAMPLES_DIR) -s clean" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) ""  >> $(PEGASUS_RPM_SPEC_FILE_PATH)

_append_filesSectionToSpecFile:
	@$(ECHO-E) "%files devel"  >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "%defattr($(Prw_r__r__),$(INSTALL_USR),$(INSTALL_GRP),$(Prwxr_xr_x))" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "$(PEGASUS_SAMPLES_DIR)" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "$(PEGASUS_INCLUDE_DIR)/Pegasus" \
            >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "$(PEGASUS_DOC_DIR)/*" >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) "$(PEGASUS_HTML_DIR)"  >> $(PEGASUS_RPM_SPEC_FILE_PATH)
	@$(ECHO-E) ""  >> $(PEGASUS_RPM_SPEC_FILE_PATH)

removeSampleProviderNamespace:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i cimstop
	@$(ECHO) +++++ Removing existing repository named SDKExamples#DefaultCXX
	@$(RMREPOSITORY) $(REPOSITORY_ROOT)/SDKExamples\#DefaultCXX
	@$(ECHO) +++++ Removing existing repository named SDKExamples#CMPI
	@$(RMREPOSITORY) $(REPOSITORY_ROOT)/SDKExamples\#CMPI
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile cimstart

buildSDK:
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i \
            removeSampleProviderNamespace
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile -i \
            deregisterproviders
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            -f Makefile clean \
            PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            PEGASUS_SAMPLE_OBJ_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/obj \
            PEGASUS_SAMPLE_BIN_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/bin \
            PEGASUS_SAMPLE_LIB_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/lib \
            PEGASUS_PROVIDER_LIB_DIR=$(PEGASUS_HOME)/lib
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            -f Makefile all \
            PEGASUS_PROVIDER_LIB_DIR=$(PEGASUS_HOME)/lib \
            PEGASUS_INCLUDE_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_INCLUDE_DIR) \
            PEGASUS_DEST_LIB_DIR=$(PEGASUS_HOME)/lib \
            PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            PEGASUS_SAMPLE_OBJ_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/obj \
            PEGASUS_SAMPLE_BIN_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/bin \
            PEGASUS_SAMPLE_LIB_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/lib \
            PEGASUS_INDICATION_CONSUMER_LOG_DIR=\
                $(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/DefaultC++/SimpleDisplayConsumer
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/Load \
            -f Makefile createrepository PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin \
                PEGASUS_CIM_SCHEMA_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/Load/$(PEGASUS_CIM_SCHEMA)
	@$(MAKE) --directory=$(PEGASUS_ROOT)/mak -f SDKMakefile  -i \
            registerproviders PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

deregisterproviders:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/Load \
            -f Makefile deregisterproviders \
            PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

registerproviders:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/Providers/Load \
            -f Makefile registerproviders \
            PEGASUS_BIN_DIR=$(PEGASUS_HOME)/bin

testSDK:
	@$(MAKE) --directory=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            -f Makefile  testSDK \
            PEGASUS_SAMPLES_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR) \
            PEGASUS_SAMPLE_BIN_DIR=$(PEGASUS_STAGING_DIR)/$(PEGASUS_SAMPLES_DIR)/bin
